<div [formGroup]="form" class="grid grid-flow-row grid-cols-12 gap-2 px-2 py-1.5" [class.bg-gray-100]="formGroupName % 2 === 0">

  <!--   Title   -->
  <div class="col-span-12">
    <div (click)="open = !open" class="flex items-center text-sm font-medium text-gray-900 cursor-pointer">
        <span [class.transform]="open" [class.rotate-90]="open">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
          </svg>
        </span>
      {{ message() }}
    </div>
  </div>

  <!--   Group measurement + length measurements   -->
  <div class="col-span-12" [class.hidden]="!open">
    <div class="grid grid-flow-row grid-cols-12 gap-2 px-2 py-1.5">
      <!--   Group measurement headers -->
      <div class="col-span-12">
        <div class="grid grid-flow-row grid-cols-12 gap-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider px-2">
          <div class="col-span-12 md:col-span-4 lg:col-span-3">Soort</div>
          <div class="col-span-4 md:col-span-2 lg:col-span-1">Aantal</div>
          <div class="col-span-4 md:col-span-3 lg:col-span-2">Groepsgewicht</div>
          <div class="col-span-4 md:col-span-2 lg:col-span-1"><span class="hidden md:block">Afvisbeurt</span><span
            class="md:hidden">Afvisb.</span></div>
          <div class="col-span-12 md:col-span-5 lg:col-span-5">Commentaar</div>
          <div></div>
        </div>
      </div>

      <!--   Group measurements   -->
      <div class="col-span-12">
        <div class="grid grid-flow-row grid-cols-12 gap-2 px-2 py-1.5">
          <div class="col-span-12 md:col-span-4 lg:col-span-3">
            <div class="relative">
              <app-searchable-select (ngModelChange)="onSpeciesChange()" tabIndex="-1"
                                     (keydown)="navigateOnArrow($event)" [passedId]="'species-' + formGroupName"
                                     [id]="'species-' + formGroupName"
                                     formControlName="species"
                                     (onSearch)="getSpecies($event)"
                                     [options]="taxons">
                <ng-template let-rowDetail #selected>
                  <span *ngIf="rowDetail">{{'taxon.id.' + rowDetail.option.id.value | translate}}</span>
                </ng-template>

                <ng-template let-rowDetail #listItem>
                  <span *ngIf="rowDetail">{{'taxon.id.' + rowDetail.option.id.value | translate}}</span>
                </ng-template>

              </app-searchable-select>

            </div>
            <app-form-error-message showAfterSubmitted="true" [control]="species()" [submitted]="submitted"></app-form-error-message>
          </div>
          <div class="col-span-4 md:col-span-2 lg:col-span-1">
            <input (change)="amountChanged($event)" [id]="'amount-' + formGroupName" name="amount" formControlName="amount"
                   type="number" min="0"
                   (keydown)="newLineOnEnter($event); focusNextLineOnEnter($event); navigateOnArrow($event)"/>
            <app-form-error-message showAfterSubmitted="true" [control]="amount()"
                                    [submitted]="submitted"></app-form-error-message>
          </div>

          <div class="col-span-4 md:col-span-3 lg:col-span-2">
            <div class="relative rounded-md shadow-sm">
              <input [imask]="numberMask(3, 0, 99999.999)" [id]="'weight-' + formGroupName"
                     (keydown)="newLineOnEnter($event); focusNextLineOnEnter($event); navigateOnArrow($event)"
                     name="weight" type="text" formControlName="weight"
                     [class.pr-8]="(weight().dirty || weight().touched) && weight().warnings">
              <div *ngIf="(weight().dirty || weight().touched) && weight().warnings"
                   [title]="'Waarde moet tussen ' + weight().warnings.between.min + ' en ' + weight().warnings.between.max + ' liggen.'"
                   class="absolute inset-y-0 right-0 pr-3 flex items-center">
                <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"
                     xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd"
                        d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                        clip-rule="evenodd"></path>
                </svg>
              </div>
            </div>
            <app-form-error-message showAfterSubmitted="true" [control]="weight()"
                                    [submitted]="submitted"></app-form-error-message>

          </div>

          <div class="col-span-4 md:col-span-2 lg:col-span-1">
            <input (keydown)="newLineOnEnter($event); focusNextLineOnEnter($event); navigateOnArrow($event)"
                   [id]="'afvisBeurtNumber-' + formGroupName" name="afvisBeurtNumber" type="number"
                   formControlName="afvisBeurtNumber"/>
            <app-form-error-message showAfterSubmitted="true" [control]="afvisBeurtNumber()"
                                    [submitted]="submitted"></app-form-error-message>

          </div>
          <div class="col-span-11 md:col-span-5 lg:col-span-4">
            <input [id]="'comment-' + formGroupName" name="comment" type="text" formControlName="comment"
                   (keydown)="newLineOnEnter($event); focusNextLineOnEnter($event); navigateOnArrow($event); onKeyPress($event)"/>
            <app-form-error-message showAfterSubmitted="true" [control]="comment()"
                                    [submitted]="submitted"></app-form-error-message>
          </div>
          <div class="col-span-1 md:col-span-5 lg:col-span-1 text-right self-center">
            <app-dropdown-minimal>
              <button class="w-full text-left text-gray-700 block px-4 py-2 text-sm"
                      *ngIf="items().length !== 1" tabIndex="-1" (click)="remove()" type="button">
                Verwijder
              </button>
              <button (click)="toIndividualMeasurement()" class="w-full text-left text-gray-700 block px-4 py-2 text-sm" type="button">
                Individuele meting
              </button>
            </app-dropdown-minimal>
          </div>

        </div>
      </div>

      <!--   Length measurements headers   -->
      <div class="col-span-12">
        <div class="grid grid-flow-row grid-cols-12 gap-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider px-2">
          <div class="col-span-3">Lengte</div>
          <div class="col-span-8">Commentaar</div>
          <div></div>
        </div>
      </div>

      <!--   Length measurements  -->
      <div class="col-span-12">
        <div class="grid grid-flow-row grid-cols-12 gap-2 px-2 py-1.5">
          <ng-container formArrayName="individualLengths" *ngFor="let item of individualLengths().controls; let i = index;">
            <ng-container [formGroupName]="i">
              <div class="col-span-3">
                <input name="length" formControlName="length" type="number" min="0"/>
                <app-form-error-message showAfterSubmitted="true" [control]="individualLengths().at(i).get('length')" [submitted]="submitted"></app-form-error-message>
              </div>
              <div class="col-span-8">
                <input name="comment" formControlName="comment" type="text" (keydown)="onKeyPressLength($event)"/>
                <app-form-error-message showAfterSubmitted="true" [control]="individualLengths().at(i).get('comment')" [submitted]="submitted"></app-form-error-message>
              </div>
            </ng-container>
          </ng-container>
        </div>
      </div>

    </div>
  </div>
</div>
